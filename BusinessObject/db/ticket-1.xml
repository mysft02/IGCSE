<?xml version="1.0" encoding="utf-8" ?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

	<changeSet id="1" author="dung-nt">
		<createTable tableName="user">
			<column name="id" type="BIGINT" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="fullname" type="VARCHAR(255)">
				<constraints nullable="false"/>
			</column>
			<column name="email" type="VARCHAR(255)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="password" type="VARCHAR(255)">
				<constraints nullable="false"/>
			</column>
			<column name="roleid" type="BIGINT">
				<constraints nullable="false"/>
			</column>
			<column name="birthday" type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="gender" type="VARCHAR(255)">
				<constraints nullable="false"/>
			</column>
		</createTable>

		<createTable tableName="role">
			<column name="roleid" type="BIGINT" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="rolename" type="VARCHAR(255)">
				<constraints nullable="false" unique="true"/>
			</column>
		</createTable>

		<createTable tableName="course">
			<column name="id" type="BIGINT" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="VARCHAR(255)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="VARCHAR(1000)"/>
			<column name="status" type="VARCHAR(50)">
				<constraints nullable="false"/>
			</column>
			<column name="category" type="VARCHAR(255)"/>
			<column name="createdat" type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="updatedat" type="DATETIME"/>
			<column name="createdby" type="BIGINT">
				<constraints nullable="false"/>
			</column>
			<column name="updatedby" type="BIGINT"/>
		</createTable>

		<addForeignKeyConstraint
			baseTableName="user"
			baseColumnNames="roleid"
			constraintName="fk_user_role"
			referencedTableName="role"
			referencedColumnNames="roleid"
			onDelete="CASCADE"/>

		<addForeignKeyConstraint
			baseTableName="course"
			baseColumnNames="createdby"
			constraintName="fk_course_createdby"
			referencedTableName="user"
			referencedColumnNames="id"
			onDelete="CASCADE"/>

		<addForeignKeyConstraint 
			baseTableName="course" 
			baseColumnNames="updatedby" 
			constraintName="fk_course_updatedby" 
			referencedTableName="user" 
		    referencedColumnNames="id" 
			onDelete="SET NULL"/>

	</changeSet>

</databaseChangeLog>